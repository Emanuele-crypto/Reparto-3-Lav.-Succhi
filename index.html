<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Gestione Produzione Agrumi - Reparto 3</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #198754;
            color: white;
            padding: 15px 0;
            margin-bottom: 30px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #e7f5ee;
            font-weight: bold;
        }
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        .stats-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #198754;
        }
        .machine-card {
            height: 100%;
            transition: all 0.3s;
        }
        .machine-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .btn-custom {
            background-color: #198754;
            color: white;
        }
        .btn-custom:hover {
            background-color: #146c43;
            color: white;
        }
        .machine-header {
            background-color: #d1e7dd;
            text-align: center;
            font-weight: bold;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        .nav-tabs .nav-link.active {
            background-color: #e7f5ee;
            border-color: #198754 #198754 #e7f5ee;
            color: #198754;
            font-weight: bold;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .status-free {
            background-color: #d1e7dd;
            color: #0f5132;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-busy {
            background-color: #f8d7da;
            color: #842029;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-maintenance {
            background-color: #fff3cd;
            color: #664d03;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .process-progress {
            height: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1><i class="bi bi-droplet-fill"></i> Reparto 3 - Lavorazione Succhi</h1>
                </div>
                <div class="col-md-6 text-end">
                    <div class="btn-group" role="group">
                        <button class="btn btn-light" id="btn-reparto-1">
                            <i class="bi bi-arrow-left-circle"></i> Reparto 1: Ricezione e scarico frutta
                        </button>
                        <button class="btn btn-light" id="btn-reparto-2">
                            <i class="bi bi-arrow-left-circle"></i> Reparto 2: Trasformazione
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <!-- Statistiche -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="lotti-in-lavorazione">0</div>
                    <div>Lotti in Lavorazione</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="concentrazione-totale">0 L</div>
                    <div>Concentrazione Totale</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="distillazione-totale">0 L</div>
                    <div>Distillazione Totale</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="pastorizzazione-totale">0 L</div>
                    <div>Pastorizzazione Totale</div>
                </div>
            </div>
        </div>

        <!-- Sezioni di lavorazione -->
        <ul class="nav nav-tabs mb-4" id="lavorazione-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="concentratori-tab" data-bs-toggle="tab" data-bs-target="#concentratori-content" type="button" role="tab">Concentratori</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="distillatori-tab" data-bs-toggle="tab" data-bs-target="#distillatori-content" type="button" role="tab">Distillatori</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pastorizzatori-tab" data-bs-toggle="tab" data-bs-target="#pastorizzatori-content" type="button" role="tab">Pastorizzatori</button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- CONCENTRATORI -->
            <div class="tab-pane fade show active" id="concentratori-content" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="bi bi-funnel-fill"></i> Concentratori - Stato Macchine
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">APV1</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Brix Input:</strong> -</p>
                                        <p><strong>Brix Target:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#concentrazioneModal" data-machine="APV1" data-type="concentratore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">APV2</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Brix Input:</strong> -</p>
                                        <p><strong>Brix Target:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#concentrazioneModal" data-machine="APV2" data-type="concentratore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DISTILLATORI -->
            <div class="tab-pane fade" id="distillatori-content" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="bi bi-droplet"></i> Distillatori - Stato Macchine
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Santoro</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#distillazioneModal" data-machine="Santoro" data-type="distillatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Padovan</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#distillazioneModal" data-machine="Padovan" data-type="distillatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Pilato 1</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#distillazioneModal" data-machine="Pilato 1" data-type="distillatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Pilato 2</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#distillazioneModal" data-machine="Pilato 2" data-type="distillatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Joe</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#distillazioneModal" data-machine="Joe" data-type="distillatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PASTORIZZATORI -->
            <div class="tab-pane fade" id="pastorizzatori-content" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="bi bi-thermometer-half"></i> Pastorizzatori - Stato Macchine
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Pastorizzatore Arancia</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <p><strong>Tempo Pastorizzazione:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#pastorizzazioneModal" data-machine="Pastorizzatore Arancia" data-type="pastorizzatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card machine-card">
                                    <div class="card-header machine-header">Pastorizzatore Profea</div>
                                    <div class="card-body">
                                        <p><strong>Stato:</strong> <span class="status-free">Disponibile</span></p>
                                        <p><strong>Prodotto:</strong> -</p>
                                        <p><strong>Tipo Agrume:</strong> -</p>
                                        <p><strong>Certificazione:</strong> -</p>
                                        <p><strong>Temperatura:</strong> -</p>
                                        <p><strong>Tempo Pastorizzazione:</strong> -</p>
                                        <div class="progress mb-2 process-progress">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary w-100 btn-avvia-processo" data-bs-toggle="modal" data-bs-target="#pastorizzazioneModal" data-machine="Pastorizzatore Profea" data-type="pastorizzatore">
                                            <i class="bi bi-play-circle"></i> Avvia Processo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Concentrazione -->
    <div class="modal fade" id="concentrazioneModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title"><i class="bi bi-funnel-fill"></i> Processo di Concentrazione - <span id="concentratore-id"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="concentrazione-form">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="concentrazione-prodotto" class="form-label required-field">Prodotto da Concentrare</label>
                                <select class="form-select" id="concentrazione-prodotto" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Succo">Succo</option>
                                    <option value="Torchiato">Torchiato</option>
                                    <option value="Estratto">Estratto</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="concentrazione-tipo-agrume" class="form-label required-field">Tipo di Agrume</label>
                                <select class="form-select" id="concentrazione-tipo-agrume" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Arance">Arance</option>
                                    <option value="Arance Rosse">Arance Rosse</option>
                                    <option value="Limoni">Limoni</option>
                                    <option value="Mandarini">Mandarini</option>
                                    <option value="Pompelmi">Pompelmi</option>
                                    <option value="Altro">Altro</option>
                                </select>
                                <div id="altro-agrume-concentrazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altro-agrume-concentrazione" placeholder="Specifica altro agrume">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="concentrazione-certificazione" class="form-label required-field">Certificazione</label>
                                <select class="form-select" id="concentrazione-certificazione" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="BIO EU">BIO EU</option>
                                    <option value="BIO DEMETER">BIO DEMETER</option>
                                    <option value="CONVENZIONALE">CONVENZIONALE</option>
                                    <option value="IGP">IGP</option>
                                    <option value="ALTRO">ALTRO</option>
                                </select>
                                <div id="altra-certificazione-concentrazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altra-certificazione-concentrazione" placeholder="Specifica altra certificazione">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="concentrazione-linea" class="form-label required-field">Linea di Trasformazione</label>
                                <select class="form-select" id="concentrazione-linea" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="BOE">BOE</option>
                                    <option value="GOE INT">GOE INT</option>
                                    <option value="B/SF">B/SF</option>
                                    <option value="400">400</option>
                                    <option value="ALTRA">ALTRA</option>
                                </select>
                                <div id="altra-linea-concentrazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altra-linea-concentrazione" placeholder="Specifica altra linea">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="concentrazione-tenore-polpa" class="form-label required-field">Tenore di Polpa</label>
                                <select class="form-select" id="concentrazione-tenore-polpa" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Limpido">Limpido</option>
                                    <option value="Semiclear">Semiclear</option>
                                    <option value="> 1%">> 1%</option>
                                    <option value="Standard">Standard</option>
                                    <option value="Altro">Altro</option>
                                </select>
                                <div id="altro-tenore-polpa-concentrazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altro-tenore-polpa-concentrazione" placeholder="Specifica altro tenore di polpa">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="concentrazione-quantita" class="form-label required-field">Quantità (L)</label>
                                <input type="number" class="form-control" id="concentrazione-quantita" required min="1">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="concentrazione-brix-iniziale" class="form-label required-field">Brix Iniziale</label>
                                <input type="number" class="form-control" id="concentrazione-brix-iniziale" required min="1" max="100" step="0.1">
                            </div>
                            <div class="col-md-6">
                                <label for="concentrazione-brix-target" class="form-label required-field">Brix Target</label>
                                <input type="number" class="form-control" id="concentrazione-brix-target" required min="1" max="100" step="0.1">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="concentrazione-note" class="form-label">Note</label>
                                <textarea class="form-control" id="concentrazione-note" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-custom" id="btn-start-concentrazione">Avvia Concentrazione</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Distillazione -->
    <div class="modal fade" id="distillazioneModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title"><i class="bi bi-droplet"></i> Processo di Distillazione - <span id="distillatore-id"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="distillazione-form">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="distillazione-prodotto" class="form-label required-field">Prodotto da Distillare</label>
                                <select class="form-select" id="distillazione-prodotto" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Succo">Succo</option>
                                    <option value="Torchiato">Torchiato</option>
                                    <option value="Estratto">Estratto</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="distillazione-tipo-agrume" class="form-label required-field">Tipo di Agrume</label>
                                <select class="form-select" id="distillazione-tipo-agrume" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Arance">Arance</option>
                                    <option value="Arance Rosse">Arance Rosse</option>
                                    <option value="Limoni">Limoni</option>
                                    <option value="Mandarini">Mandarini</option>
                                    <option value="Pompelmi">Pompelmi</option>
                                    <option value="Altro">Altro</option>
                                </select>
                                <div id="altro-agrume-distillazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altro-agrume-distillazione" placeholder="Specifica altro agrume">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="distillazione-certificazione" class="form-label required-field">Certificazione</label>
                                <select class="form-select" id="distillazione-certificazione" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="BIO EU">BIO EU</option><option value="BIO DEMETER">BIO DEMETER</option>
                                    <option value="CONVENZIONALE">CONVENZIONALE</option>
                                    <option value="IGP">IGP</option>
                                    <option value="ALTRO">ALTRO</option>
                                </select>
                                <div id="altra-certificazione-distillazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altra-certificazione-distillazione" placeholder="Specifica altra certificazione">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="distillazione-linea" class="form-label required-field">Linea di Trasformazione</label>
                                <select class="form-select" id="distillazione-linea" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="BOE">BOE</option>
                                    <option value="GOE INT">GOE INT</option>
                                    <option value="B/SF">B/SF</option>
                                    <option value="400">400</option>
                                    <option value="ALTRA">ALTRA</option>
                                </select>
                                <div id="altra-linea-distillazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altra-linea-distillazione" placeholder="Specifica altra linea">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="distillazione-tenore-polpa" class="form-label required-field">Tenore di Polpa</label>
                                <select class="form-select" id="distillazione-tenore-polpa" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Limpido">Limpido</option>
                                    <option value="Semiclear">Semiclear</option>
                                    <option value="> 1%">> 1%</option>
                                    <option value="Standard">Standard</option>
                                    <option value="Altro">Altro</option>
                                </select>
                                <div id="altro-tenore-polpa-distillazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altro-tenore-polpa-distillazione" placeholder="Specifica altro tenore di polpa">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="distillazione-quantita" class="form-label required-field">Quantità (L)</label>
                                <input type="number" class="form-control" id="distillazione-quantita" required min="1">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="distillazione-temperatura" class="form-label required-field">Temperatura (°C)</label>
                                <input type="number" class="form-control" id="distillazione-temperatura" required min="1" max="200" step="0.1">
                            </div>
                            <div class="col-md-6">
                                <label for="distillazione-tempo" class="form-label required-field">Tempo di Processo (min)</label>
                                <input type="number" class="form-control" id="distillazione-tempo" required min="1" max="1440">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="distillazione-note" class="form-label">Note</label>
                                <textarea class="form-control" id="distillazione-note" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-custom" id="btn-start-distillazione">Avvia Distillazione</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Pastorizzazione -->
    <div class="modal fade" id="pastorizzazioneModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title"><i class="bi bi-thermometer-half"></i> Processo di Pastorizzazione - <span id="pastorizzatore-id"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="pastorizzazione-form">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="pastorizzazione-prodotto" class="form-label required-field">Prodotto da Pastorizzare</label>
                                <select class="form-select" id="pastorizzazione-prodotto" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Succo">Succo</option>
                                    <option value="Torchiato">Torchiato</option>
                                    <option value="Estratto">Estratto</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pastorizzazione-tipo-agrume" class="form-label required-field">Tipo di Agrume</label>
                                <select class="form-select" id="pastorizzazione-tipo-agrume" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Arance">Arance</option>
                                    <option value="Arance Rosse">Arance Rosse</option>
                                    <option value="Limoni">Limoni</option>
                                    <option value="Mandarini">Mandarini</option>
                                    <option value="Pompelmi">Pompelmi</option>
                                    <option value="Altro">Altro</option>
                                </select>
                                <div id="altro-agrume-pastorizzazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altro-agrume-pastorizzazione" placeholder="Specifica altro agrume">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="pastorizzazione-certificazione" class="form-label required-field">Certificazione</label>
                                <select class="form-select" id="pastorizzazione-certificazione" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="BIO EU">BIO EU</option>
                                    <option value="BIO DEMETER">BIO DEMETER</option>
                                    <option value="CONVENZIONALE">CONVENZIONALE</option>
                                    <option value="IGP">IGP</option>
                                    <option value="ALTRO">ALTRO</option>
                                </select>
                                <div id="altra-certificazione-pastorizzazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altra-certificazione-pastorizzazione" placeholder="Specifica altra certificazione">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="pastorizzazione-linea" class="form-label required-field">Linea di Trasformazione</label>
                                <select class="form-select" id="pastorizzazione-linea" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="BOE">BOE</option>
                                    <option value="GOE INT">GOE INT</option>
                                    <option value="B/SF">B/SF</option>
                                    <option value="400">400</option>
                                    <option value="ALTRA">ALTRA</option>
                                </select>
                                <div id="altra-linea-pastorizzazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altra-linea-pastorizzazione" placeholder="Specifica altra linea">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="pastorizzazione-tenore-polpa" class="form-label required-field">Tenore di Polpa</label>
                                <select class="form-select" id="pastorizzazione-tenore-polpa" required>
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="Limpido">Limpido</option>
                                    <option value="Semiclear">Semiclear</option>
                                    <option value="> 1%">> 1%</option>
                                    <option value="Standard">Standard</option>
                                    <option value="Altro">Altro</option>
                                </select>
                                <div id="altro-tenore-polpa-pastorizzazione-container" style="display: none;" class="mt-2">
                                    <input type="text" class="form-control" id="altro-tenore-polpa-pastorizzazione" placeholder="Specifica altro tenore di polpa">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="pastorizzazione-quantita" class="form-label required-field">Quantità (L)</label>
                                <input type="number" class="form-control" id="pastorizzazione-quantita" required min="1">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="pastorizzazione-temperatura" class="form-label required-field">Temperatura (°C)</label>
                                <input type="number" class="form-control" id="pastorizzazione-temperatura" required min="1" max="200" step="0.1">
                            </div>
                            <div class="col-md-6">
                                <label for="pastorizzazione-tempo" class="form-label required-field">Tempo di Pastorizzazione (min)</label>
                                <input type="number" class="form-control" id="pastorizzazione-tempo" required min="1" max="1440">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="pastorizzazione-note" class="form-label">Note</label>
                                <textarea class="form-control" id="pastorizzazione-note" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-custom" id="btn-start-pastorizzazione">Avvia Pastorizzazione</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Script JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Dati di stato
            let lottiCount = 0;
            let concentrazioneTotale = 0;
            let distillazioneTotale = 0;
            let pastorizzazioneTotale = 0;
            
            // Stato macchine
            const machines = {
                // Concentratori
                "APV1": { tipo: "concentratore", stato: "Disponibile", dati: {} },
                "APV2": { tipo: "concentratore", stato: "Disponibile", dati: {} },
                
                // Distillatori
                "Santoro": { tipo: "distillatore", stato: "Disponibile", dati: {} },
                "Padovan": { tipo: "distillatore", stato: "Disponibile", dati: {} },
                "Pilato 1": { tipo: "distillatore", stato: "Disponibile", dati: {} },
                "Pilato 2": { tipo: "distillatore", stato: "Disponibile", dati: {} },
                "Joe": { tipo: "distillatore", stato: "Disponibile", dati: {} },
                
                // Pastorizzatori
                "Pastorizzatore Arancia": { tipo: "pastorizzatore", stato: "Disponibile", dati: {} },
                "Pastorizzatore Profea": { tipo: "pastorizzatore", stato: "Disponibile", dati: {} }
            };
            
            // Inizializzazione statistiche
            updateStats();
            
            // Eventi per i campi "Altro"
            
            // Concentrazione
            $("#concentrazione-tipo-agrume").change(function() {
                if ($(this).val() === "Altro") {
                    $("#altro-agrume-concentrazione-container").show();
                } else {
                    $("#altro-agrume-concentrazione-container").hide();
                    $("#altro-agrume-concentrazione").val("");
                }
            });
            
            $("#concentrazione-certificazione").change(function() {
                if ($(this).val() === "ALTRO") {
                    $("#altra-certificazione-concentrazione-container").show();
                } else {
                    $("#altra-certificazione-concentrazione-container").hide();
                    $("#altra-certificazione-concentrazione").val("");
                }
            });
            
            $("#concentrazione-linea").change(function() {
                if ($(this).val() === "ALTRA") {
                    $("#altra-linea-concentrazione-container").show();
                } else {
                    $("#altra-linea-concentrazione-container").hide();
                    $("#altra-linea-concentrazione").val("");
                }
            });
            
            $("#concentrazione-tenore-polpa").change(function() {
                if ($(this).val() === "Altro") {
                    $("#altro-tenore-polpa-concentrazione-container").show();
                } else {
                    $("#altro-tenore-polpa-concentrazione-container").hide();
                    $("#altro-tenore-polpa-concentrazione").val("");
                }
            });
            
            // Distillazione
            $("#distillazione-tipo-agrume").change(function() {
                if ($(this).val() === "Altro") {
                    $("#altro-agrume-distillazione-container").show();
                } else {
                    $("#altro-agrume-distillazione-container").hide();
                    $("#altro-agrume-distillazione").val("");
                }
            });
            
            $("#distillazione-certificazione").change(function() {
                if ($(this).val() === "ALTRO") {
                    $("#altra-certificazione-distillazione-container").show();
                } else {
                    $("#altra-certificazione-distillazione-container").hide();
                    $("#altra-certificazione-distillazione").val("");
                }
            });
            
            $("#distillazione-linea").change(function() {
                if ($(this).val() === "ALTRA") {
                    $("#altra-linea-distillazione-container").show();
                } else {
                    $("#altra-linea-distillazione-container").hide();
                    $("#altra-linea-distillazione").val("");
                }
            });
            
            $("#distillazione-tenore-polpa").change(function() {
                if ($(this).val() === "Altro") {
                    $("#altro-tenore-polpa-distillazione-container").show();
                } else {
                    $("#altro-tenore-polpa-distillazione-container").hide();
                    $("#altro-tenore-polpa-distillazione").val("");
                }
            });
            
            // Pastorizzazione
            $("#pastorizzazione-tipo-agrume").change(function() {
                if ($(this).val() === "Altro") {
                    $("#altro-agrume-pastorizzazione-container").show();
                } else {
                    $("#altro-agrume-pastorizzazione-container").hide();
                    $("#altro-agrume-pastorizzazione").val("");
                }
            });
            
            $("#pastorizzazione-certificazione").change(function() {
                if ($(this).val() === "ALTRO") {
                    $("#altra-certificazione-pastorizzazione-container").show();
                } else {
                    $("#altra-certificazione-pastorizzazione-container").hide();
                    $("#altra-certificazione-pastorizzazione").val("");
                }
            });
            
            $("#pastorizzazione-linea").change(function() {
                if ($(this).val() === "ALTRA") {
                    $("#altra-linea-pastorizzazione-container").show();
                } else {
                    $("#altra-linea-pastorizzazione-container").hide();
                    $("#altra-linea-pastorizzazione").val("");
                }
            });
            
            $("#pastorizzazione-tenore-polpa").change(function() {
                if ($(this).val() === "Altro") {
                    $("#altro-tenore-polpa-pastorizzazione-container").show();
                } else {
                    $("#altro-tenore-polpa-pastorizzazione-container").hide();
                    $("#altro-tenore-polpa-pastorizzazione").val("");
                }
            });
            
            // Apertura modal con selezione macchina
            $(".btn-avvia-processo").click(function() {
                const machineName = $(this).data("machine");
                const machineType = $(this).data("type");
                
                if (machineType === "concentratore") {
                    $("#concentratore-id").text(machineName);
                    resetForm("concentrazione");
                } else if (machineType === "distillatore") {
                    $("#distillatore-id").text(machineName);
                    resetForm("distillazione");
                } else if (machineType === "pastorizzatore") {
                    $("#pastorizzatore-id").text(machineName);
                    resetForm("pastorizzazione");
                }
            });
            
            // Avvio processo di concentrazione
            $("#btn-start-concentrazione").click(function() {
                const machineName = $("#concentratore-id").text();
                
                // Validazione dei campi
                if (!validateForm("concentrazione")) {
                    return;
                }
                
                // Raccolta dati
                let prodotto = $("#concentrazione-prodotto").val();
                
                let tipoAgrume = $("#concentrazione-tipo-agrume").val();
                if (tipoAgrume === "Altro") {
                    tipoAgrume = $("#altro-agrume-concentrazione").val();
                }
                
                let certificazione = $("#concentrazione-certificazione").val();
                if (certificazione === "ALTRO") {
                    certificazione = $("#altra-certificazione-concentrazione").val();
                }
                
                let linea = $("#concentrazione-linea").val();
                if (linea === "ALTRA") {
                    linea = $("#altra-linea-concentrazione").val();
                }
                
                let tenorePolpa = $("#concentrazione-tenore-polpa").val();
                if (tenorePolpa === "Altro") {
                    tenorePolpa = $("#altro-tenore-polpa-concentrazione").val();
                }
                
                let quantita = parseInt($("#concentrazione-quantita").val());
                let brixIniziale = parseFloat($("#concentrazione-brix-iniziale").val());
                let brixTarget = parseFloat($("#concentrazione-brix-target").val());
                let note = $("#concentrazione-note").val();
                
                // Aggiornamento dati macchina
                machines[machineName] = {
                    tipo: "concentratore",
                    stato: "Occupato",
                    dati: {
                        prodotto: prodotto,
                        tipoAgrume: tipoAgrume,
                        certificazione: certificazione,
                        linea: linea,
                        tenorePolpa: tenorePolpa,
                        quantita: quantita,
                        brixIniziale: brixIniziale,
                        brixTarget: brixTarget,
                        note: note,
                        progresso: 0,
                        tempoInizio: new Date().getTime()
                    }
                };
                
                // Aggiornamento UI
                updateMachineUI(machineName);
                
                // Incremento contatori
                lottiCount++;
                concentrazioneTotale += quantita;
                updateStats();
                
                // Chiusura modal
                var modal = bootstrap.Modal.getInstance(document.getElementById('concentrazioneModal'));
                modal.hide();
                
                // Avvio simulazione processo
                startProcess(machineName, Math.floor(Math.random() * 120) + 60); // Tempo tra 60 e 180 minuti
                
                alert("Processo di concentrazione avviato!");
            });
            
            // Avvio processo di distillazione
            $("#btn-start-distillazione").click(function() {
                const machineName = $("#distillatore-id").text();
                
                // Validazione dei campi
                if (!validateForm("distillazione")) {
                    return;
                }
                
                // Raccolta dati
                let prodotto = $("#distillazione-prodotto").val();
                
                let tipoAgrume = $("#distillazione-tipo-agrume").val();
                if (tipoAgrume === "Altro") {
                    tipoAgrume = $("#altro-agrume-distillazione").val();
                }
                
                let certificazione = $("#distillazione-certificazione").val();
                if (certificazione === "ALTRO") {
                    certificazione = $("#altra-certificazione-distillazione").val();
                }
                
                let linea = $("#distillazione-linea").val();
                if (linea === "ALTRA") {
                    linea = $("#altra-linea-distillazione").val();
                }
                
                let tenorePolpa = $("#distillazione-tenore-polpa").val();
                if (tenorePolpa === "Altro") {
                    tenorePolpa = $("#altro-tenore-polpa-distillazione").val();
                }
                
                let quantita = parseInt($("#distillazione-quantita").val());
                let temperatura = parseFloat($("#distillazione-temperatura").val());
                let tempo = parseInt($("#distillazione-tempo").val());
                let note = $("#distillazione-note").val();
                
                // Aggiornamento dati macchina
                machines[machineName] = {
                    tipo: "distillatore",
                    stato: "Occupato",
                    dati: {
                        prodotto: prodotto,
                        tipoAgrume: tipoAgrume,
                        certificazione: certificazione,
                        linea: linea,
                        tenorePolpa: tenorePolpa,
                        quantita: quantita,
                        temperatura: temperatura,
                        tempo: tempo,
                        note: note,
                        progresso: 0,
                        tempoInizio: new Date().getTime()
                    }
                };
                
                // Aggiornamento UI
                updateMachineUI(machineName);
                
                // Incremento contatori
                lottiCount++;
                distillazioneTotale += quantita;
                updateStats();
                
                // Chiusura modal
                var modal = bootstrap.Modal.getInstance(document.getElementById('distillazioneModal'));
                modal.hide();
                
                // Avvio simulazione processo
                startProcess(machineName, tempo);
                
                alert("Processo di distillazione avviato!");
            });
            
            // Avvio processo di pastorizzazione
            $("#btn-start-pastorizzazione").click(function() {
                const machineName = $("#pastorizzatore-id").text();
                
                // Validazione dei campi
                if (!validateForm("pastorizzazione")) {
                    return;
                }
                
                // Raccolta dati
                let prodotto = $("#pastorizzazione-prodotto").val();
                
                let tipoAgrume = $("#pastorizzazione-tipo-agrume").val();
                if (tipoAgrume === "Altro") {
                    tipoAgrume = $("#altro-agrume-pastorizzazione").val();
                }
                
                let certificazione = $("#pastorizzazione-certificazione").val();
                if (certificazione === "ALTRO") {
                    certificazione = $("#altra-certificazione-pastorizzazione").val();
                }
                
                let linea = $("#pastorizzazione-linea").val();
                if (linea === "ALTRA") {
                    linea = $("#altra-linea-pastorizzazione").val();
                }
                
                let tenorePolpa = $("#pastorizzazione-tenore-polpa").val();
                if (tenorePolpa === "Altro") {
                    tenorePolpa = $("#altro-tenore-polpa-pastorizzazione").val();
                }
                
                let quantita = parseInt($("#pastorizzazione-quantita").val());
                let temperatura = parseFloat($("#pastorizzazione-temperatura").val());
                let tempo = parseInt($("#pastorizzazione-tempo").val());
                let note = $("#pastorizzazione-note").val();
                
                // Aggiornamento dati macchina
                machines[machineName] = {
                    tipo: "pastorizzatore",
                    stato: "Occupato",
                    dati: {
                        prodotto: prodotto,
                        tipoAgrume: tipoAgrume,
                        certificazione: certificazione,
                        linea: linea,
                        tenorePolpa: tenorePolpa,
                        quantita: quantita,
                        temperatura: temperatura,
                        tempo: tempo,
                        note: note,
                        progresso: 0,
                        tempoInizio: new Date().getTime()
                    }
                };
                
                // Aggiornamento UI
                updateMachineUI(machineName);
                
                // Incremento contatori
                lottiCount++;
                pastorizzazioneTotale += quantita;
                updateStats();
                
                // Chiusura modal
                var modal = bootstrap.Modal.getInstance(document.getElementById('pastorizzazioneModal'));
                modal.hide();
                
                // Avvio simulazione processo
                startProcess(machineName, tempo);
                
                alert("Processo di pastorizzazione avviato!");
            });
            
            // Pulsanti di collegamento ad altri reparti
            $("#btn-reparto-1").click(function() {
                if (confirm("Passare al Reparto 1: Ricezione e scarico frutta? Le modifiche non salvate andranno perse.")) {
                    alert("Collegamento al Reparto 1 simulato.");
                }
            });
            
            $("#btn-reparto-2").click(function() {
                if (confirm("Passare al Reparto 2: Trasformazione? Le modifiche non salvate andranno perse.")) {
                    alert("Collegamento al Reparto 2 simulato.");
                }
            });
            
            // FUNZIONI DI SUPPORTO
            
            // Aggiornamento statistiche
            function updateStats() {
                $("#lotti-in-lavorazione").text(lottiCount);
                $("#concentrazione-totale").text(concentrazioneTotale + " L");
                $("#distillazione-totale").text(distillazioneTotale + " L");
                $("#pastorizzazione-totale").text(pastorizzazioneTotale + " L");
            }
            
            // Reset form
            function resetForm(formType) {
                $(`#${formType}-form`)[0].reset();
                $(`[id^='altro-'][id$='-${formType}-container']`).hide();
                $(`[id^='altra-'][id$='-${formType}-container']`).hide();
            }
            
            // Validazione form
            function validateForm(formType) {
                const requiredFields = $(`#${formType}-form`).find("[required]");
                let isValid = true;
                
                requiredFields.each(function() {
                    if (!$(this).val()) {
                        isValid = false;
                        $(this).addClass("is-invalid");
                    } else {
                        $(this).removeClass("is-invalid");
                    }
                });
                
                // Verifica campi "Altro"
                if ($(`#${formType}-tipo-agrume`).val() === "Altro" && !$(`#altro-agrume-${formType}`).val()) {
                    isValid = false;
                    $(`#altro-agrume-${formType}`).addClass("is-invalid");
                }
                
                if ($(`#${formType}-certificazione`).val() === "ALTRO" && !$(`#altra-certificazione-${formType}`).val()) {
                    isValid = false;
                    $(`#altra-certificazione-${formType}`).addClass("is-invalid");
                }
                
                if ($(`#${formType}-linea`).val() === "ALTRA" && !$(`#altra-linea-${formType}`).val()) {
                    isValid = false;
                    $(`#altra-linea-${formType}`).addClass("is-invalid");
                }
                
                if ($(`#${formType}-tenore-polpa`).val() === "Altro" && !$(`#altro-tenore-polpa-${formType}`).val()) {
                    isValid = false;
                    $(`#altro-tenore-polpa-${formType}`).addClass("is-invalid");
                }
                
                if (!isValid) {
                    alert("Compila tutti i campi obbligatori!");
                }
                
                return isValid;
            }
            
            // Aggiornamento UI macchina
            function updateMachineUI(machineName) {
                const machine = machines[machineName];
                const machineCard = $(`.card-header:contains(${machineName})`).closest(".card");
                
                if (machine.stato === "Occupato") {
                    machineCard.find("strong:contains('Stato:')").next().removeClass("status-free").addClass("status-busy").text("Occupato");
                    machineCard.find("strong:contains('Prodotto:')").parent().text(`Prodotto: ${machine.dati.prodotto}`);
                    machineCard.find("strong:contains('Tipo Agrume:')").parent().text(`Tipo Agrume: ${machine.machineCard.find("strong:contains('Tipo Agrume:')").parent().text(`Tipo Agrume: ${machine.dati.tipoAgrume}`);
                   machineCard.find("strong:contains('Certificazione:')").parent().text(`Certificazione: ${machine.dati.certificazione}`);
                   
                   if (machine.tipo === "concentratore") {
                       machineCard.find("strong:contains('Brix Input:')").parent().text(`Brix Input: ${machine.dati.brixIniziale}`);
                       machineCard.find("strong:contains('Brix Target:')").parent().text(`Brix Target: ${machine.dati.brixTarget}`);
                   } else {
                       machineCard.find("strong:contains('Temperatura:')").parent().text(`Temperatura: ${machine.dati.temperatura}°C`);
                       if (machine.tipo === "pastorizzatore") {
                           machineCard.find("strong:contains('Tempo Pastorizzazione:')").parent().text(`Tempo Pastorizzazione: ${machine.dati.tempo} min`);
                       }
                   }
                   
                   // Disabilita il pulsante "Avvia Processo"
                   machineCard.find(".btn-avvia-processo").prop("disabled", true);
                   
                   // Imposta la barra di progresso
                   machineCard.find(".progress-bar").css("width", `${machine.dati.progresso}%`).attr("aria-valuenow", machine.dati.progresso);
               } else {
                   machineCard.find("strong:contains('Stato:')").next().removeClass("status-busy").addClass("status-free").text("Disponibile");
                   machineCard.find("strong:contains('Prodotto:')").parent().text("Prodotto: -");
                   machineCard.find("strong:contains('Tipo Agrume:')").parent().text("Tipo Agrume: -");
                   machineCard.find("strong:contains('Certificazione:')").parent().text("Certificazione: -");
                   
                   if (machine.tipo === "concentratore") {
                       machineCard.find("strong:contains('Brix Input:')").parent().text("Brix Input: -");
                       machineCard.find("strong:contains('Brix Target:')").parent().text("Brix Target: -");
                   } else {
                       machineCard.find("strong:contains('Temperatura:')").parent().text("Temperatura: -");
                       if (machine.tipo === "pastorizzatore") {
                           machineCard.find("strong:contains('Tempo Pastorizzazione:')").parent().text("Tempo Pastorizzazione: -");
                       }
                   }
                   
                   // Abilita il pulsante "Avvia Processo"
                   machineCard.find(".btn-avvia-processo").prop("disabled", false);
                   
                   // Resetta la barra di progresso
                   machineCard.find(".progress-bar").css("width", "0%").attr("aria-valuenow", 0);
               }
           }
           
           // Avvio simulazione processo
           function startProcess(machineName, durationMinutes) {
               // Converti minuti in millisecondi per la simulazione
               const totalDuration = durationMinutes * 60 * 1000;
               const updateInterval = 5000; // Aggiorna ogni 5 secondi
               const steps = totalDuration / updateInterval;
               let currentStep = 0;
               
               // Funzione di aggiornamento
               const updateProcess = function() {
                   currentStep++;
                   
                   // Calcolo progresso
                   const progress = Math.min(Math.round((currentStep / steps) * 100), 100);
                   
                   // Aggiornamento stato macchina
                   machines[machineName].dati.progresso = progress;
                   
                   // Aggiornamento UI
                   updateMachineUI(machineName);
                   
                   // Se il processo è completato
                   if (progress >= 100) {
                       // Aggiornamento stato macchina
                       machines[machineName].stato = "Disponibile";
                       machines[machineName].dati = {};
                       
                       // Notifica completamento
                       alert(`Processo completato su ${machineName}!`);
                       
                       // Aggiornamento UI
                       updateMachineUI(machineName);
                       
                       clearInterval(intervalId);
                   }
               };
               
               // Avvio intervallo di aggiornamento
               const intervalId = setInterval(updateProcess, updateInterval);
           }
       });
   </script>
</body>
</html>
